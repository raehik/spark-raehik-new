---
- name: Install Linux
  pacman: name=linux,linux-firmware state=present

- name: Install AMD microcode
  pacman: name=amd-ucode state=present

- name: Install systemd-boot bootloader
  command: bootctl --path=/boot install

- name: Install systemd-boot config
  template:
    src: loader.conf.j2
    dest: /boot/loader/loader.conf
  vars:
  - default_entry: "{{ hostname }}-mkinitcpio"

- name: Install systemd-boot entry - mkinitcpio
  template:
    src: entry.conf.j2
    dest: /boot/loader/entries/{{ hostname }}-mkinitcpio.conf
  vars:
  - lvm_vg: "{{ hostname }}"
    luks_partition: "{{ hostname }}"
    title: "{{ hostname }}-mkinitcpio"
    initramfs: /initramfs-linux.img

- name: Install systemd-boot entry - mkinitcpio fallback
  template:
    src: entry.conf.j2
    dest: /boot/loader/entries/{{ hostname }}-mkinitcpio-fallback.conf
  vars:
  - lvm_vg: "{{ hostname }}"
    luks_partition: "{{ hostname }}"
    title: "{{ hostname }}-mkinitcpio-fallback"
    initramfs: /initramfs-linux-fallback.img
